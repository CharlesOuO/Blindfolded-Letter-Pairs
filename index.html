<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›²è§£é›™å­—è©åº«ç·´ç¿’</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* é ‚éƒ¨å°èˆª */
        .nav-bar {
            background: white;
            width: 100%;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-btn {
            padding: 10px 25px;
            font-size: 1rem;
            border: 2px solid #2196f3;
            background: white;
            color: #2196f3;
            border-radius: 20px;
            cursor: pointer;
            margin: 0 10px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: #2196f3;
            color: white;
        }

        .container {
            max-width: 600px;
            width: 95%;
            margin-top: 20px;
            padding-bottom: 50px;
        }

        /* --- åˆ—è¡¨/èƒŒèª¦æ¨¡å¼æ¨£å¼ --- */
        .list-controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        select {
            padding: 10px;
            font-size: 1.2rem;
            width: 100%;
            max-width: 300px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .pair-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        .pair-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            text-align: center;
        }

        .pair-input {
            padding: 5px;
            font-size: 1.1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            width: 90%;
            align-self: center;
        }

        .pair-input:focus {
            border-color: #2196f3;
            outline: none;
            background: #e3f2fd;
        }

        /* --- è¨˜æ†¶æ¨¡å¼æ¨£å¼ (æ²¿ç”¨èˆŠç‰ˆ) --- */
        .card-area {
            background: white;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 40px;
            margin: 20px 0;
            text-align: center;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .question { font-size: 5rem; font-weight: bold; color: #1565c0; }
        .answer { font-size: 2.5rem; color: #d32f2f; margin-top: 20px; font-weight: bold; display: none; }
        .answer.show { display: block; }
        .hint { color: #999; margin-top: 15px; font-size: 0.9rem; }

        .memory-controls { text-align: center; }
        .btn-primary {
            padding: 12px 30px;
            font-size: 1.2rem;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        }

        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .view-section { display: none; }
        .view-section.active { display: block; }

    </style>
</head>
<body>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchTab('list')">ğŸ“ åˆ—è¡¨èƒŒèª¦/è¼¸å…¥</button>
        <button class="nav-btn" onclick="switchTab('memory')">ğŸ§  éš¨æ©Ÿè¨˜æ†¶</button>
    </div>

    <div class="container">

        <div id="view-list" class="view-section active">
            <div class="list-controls">
                <label style="display:block; margin-bottom:5px; color:#666;">é¸æ“‡é–‹é ­æ³¨éŸ³ï¼š</label>
                <select id="char-select" onchange="renderList()">
                    </select>
                <p style="font-size:0.9rem; color:#888; margin-top:10px;">
                    ğŸ’¡ æç¤ºï¼šè¼¸å…¥å®Œç›´æ¥æŒ‰ Enter æœƒè·³åˆ°ä¸‹ä¸€æ ¼ã€‚
                </p>
            </div>

            <div id="grid-area" class="grid-container">
                </div>
        </div>

        <div id="view-memory" class="view-section">
            <div class="list-controls">
                <label style="color:#666;">ç¯„åœè¨­å®šï¼š</label>
                <select id="memory-range" onchange="nextCard()">
                    <option value="all">å…¨ç¯„åœéš¨æ©Ÿ (All)</option>
                    </select>
            </div>

            <div class="card-area" onclick="toggleAnswer()">
                <div class="question" id="q-text">?</div>
                <div class="answer" id="a-text">...</div>
                <div class="hint" id="hint-text">(é»æ“Šç¿»ç‰Œçœ‹ç­”æ¡ˆ)</div>
            </div>

            <div class="memory-controls">
                <button class="btn-primary" onclick="nextCard()">ä¸‹ä¸€é¡Œ (Space)</button>
            </div>
            
            <div style="text-align:center; margin-top:20px; color:#888; font-size:0.9rem;">
                å¦‚æœåœ¨è¨˜æ†¶æ¨¡å¼ç™¼ç¾è©æƒ³æ”¹ï¼Œè«‹åˆ‡å›ã€Œåˆ—è¡¨æ¨¡å¼ã€ä¿®æ”¹ã€‚
            </div>
        </div>

    </div>

    <script>
        // --- 1. å®šç¾©æ³¨éŸ³åˆ—è¡¨ (24å­—) ---
        const chars = [
            'ã„…','ã„†','ã„‡','ã„ˆ',
            'ã„‰','ã„Š','ã„‹','ã„Œ',
            'ã„','ã„','ã„',
            'ã„','ã„‘','ã„’',
            'ã„“','ã„”','ã„•','ã„–',
            'ã„—','ã„˜','ã„™',
            'ã„§','ã„¨','ã„©'
        ];

        // --- 2. è³‡æ–™å­˜å– (ä½¿ç”¨ LocalStorage) ---
        // æ ¼å¼: { "ã„…ã„‡": "æ–‘é¦¬", "ã„©ã„™": "é›¨å‚˜" ... }
        const STORAGE_KEY = 'bld_custom_dict_v3';
        
        function getDict() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        }

        function saveDict(newDict) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(newDict));
        }

        function saveWord(pair, word) {
            const dict = getDict();
            dict[pair] = word.trim();
            saveDict(dict);
        }

        // --- 3. ä»‹é¢åˆå§‹åŒ– ---
        
        function init() {
            // å¡«å…¥ä¸‹æ‹‰é¸å–® (åˆ—è¡¨æ¨¡å¼)
            const listSelect = document.getElementById('char-select');
            // å¡«å…¥ä¸‹æ‹‰é¸å–® (è¨˜æ†¶æ¨¡å¼)
            const memSelect = document.getElementById('memory-range');

            chars.forEach(c => {
                // List Mode Select
                let opt1 = document.createElement('option');
                opt1.value = c;
                opt1.innerText = `${c} é–‹é ­ (ä¾‹å¦‚ ${c}X)`;
                listSelect.appendChild(opt1);

                // Memory Mode Select
                let opt2 = document.createElement('option');
                opt2.value = c;
                opt2.innerText = `åªç·´ ${c} é–‹é ­`;
                memSelect.appendChild(opt2);
            });

            // é è¨­æ¸²æŸ“åˆ—è¡¨
            renderList();
        }

        // --- 4. åˆ—è¡¨æ¨¡å¼é‚è¼¯ ---

        function renderList() {
            const startChar = document.getElementById('char-select').value;
            const container = document.getElementById('grid-area');
            const dict = getDict();

            container.innerHTML = ''; // æ¸…ç©º

            chars.forEach((endChar, index) => {
                if (startChar === endChar) return; // è·³éé‡è¤‡ (å¦‚ ã„…ã„…)

                const pair = startChar + endChar;
                const savedWord = dict[pair] || ""; // å¦‚æœæ²’å­˜éå°±æ˜¯ç©ºå­—ä¸²

                // å»ºç«‹å¡ç‰‡ HTML
                const div = document.createElement('div');
                div.className = 'pair-item';
                
                const label = document.createElement('div');
                label.className = 'pair-label';
                label.innerText = pair;

                const input = document.createElement('input');
                input.className = 'pair-input';
                input.type = 'text';
                input.value = savedWord;
                input.placeholder = "è¼¸å…¥è©...";
                input.dataset.pair = pair; // ç¶å®š key
                
                // äº‹ä»¶ï¼šè¼¸å…¥æ™‚è‡ªå‹•å„²å­˜
                input.addEventListener('input', function() {
                    saveWord(this.dataset.pair, this.value);
                });

                // äº‹ä»¶ï¼šæŒ‰ Enter è·³ä¸‹ä¸€æ ¼
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        // æ‰¾ä¸‹ä¸€å€‹ input
                        const allInputs = document.querySelectorAll('.pair-input');
                        // é€™è£¡å› ç‚ºæˆ‘å€‘æ˜¯åœ¨ loop è£¡å»ºç«‹çš„ï¼ŒDOMé †åºå°±æ˜¯é¡¯ç¤ºé †åº
                        // æ‰¾å‡ºç›®å‰ input åœ¨ NodeList çš„ index
                        for(let i=0; i<allInputs.length; i++) {
                            if(allInputs[i] === this) {
                                if(i + 1 < allInputs.length) {
                                    allInputs[i+1].focus();
                                }
                                break;
                            }
                        }
                    }
                });

                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            });
        }

        // --- 5. è¨˜æ†¶æ¨¡å¼é‚è¼¯ ---
        
        let currentPair = "";
        let isAnswerShown = false;

        function nextCard() {
            const range = document.getElementById('memory-range').value;
            let c1, c2;

            if (range === 'all') {
                c1 = chars[Math.floor(Math.random() * chars.length)];
            } else {
                c1 = range;
            }

            c2 = chars[Math.floor(Math.random() * chars.length)];
            while (c1 === c2) {
                c2 = chars[Math.floor(Math.random() * chars.length)];
            }

            currentPair = c1 + c2;

            // UI Reset
            document.getElementById('q-text').innerText = currentPair;
            document.getElementById('a-text').classList.remove('show');
            document.getElementById('hint-text').innerText = "(é»æ“Šç¿»ç‰Œ)";
            isAnswerShown = false;
        }

        function toggleAnswer() {
            if (isAnswerShown) return;

            const dict = getDict();
            const word = dict[currentPair];

            const answerEl = document.getElementById('a-text');
            
            if (word) {
                answerEl.innerText = word;
                answerEl.style.color = "#d32f2f";
            } else {
                answerEl.innerText = "(å°šæœªå®šç¾©)";
                answerEl.style.color = "#999";
            }

            answerEl.classList.add('show');
            document.getElementById('hint-text').innerText = "(æŒ‰ Space ä¸‹ä¸€é¡Œ)";
            isAnswerShown = true;
        }

        // --- 6. é€šç”¨æ§åˆ¶ ---

        function switchTab(mode) {
            // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // åˆ‡æ›é¡¯ç¤ºå€å¡Š
            document.querySelectorAll('.view-section').forEach(view => view.classList.remove('active'));
            
            if (mode === 'list') {
                document.getElementById('view-list').classList.add('active');
                renderList(); // é‡æ–°æ¸²æŸ“ä»¥ç¢ºä¿è³‡æ–™æœ€æ–°
            } else {
                document.getElementById('view-memory').classList.add('active');
                nextCard(); // é€²å…¥è¨˜æ†¶æ¨¡å¼è‡ªå‹•å‡ºé¡Œ
            }
        }

        // éµç›¤ Space æ§åˆ¶ (åƒ…åœ¨è¨˜æ†¶æ¨¡å¼æœ‰æ•ˆ)
        document.addEventListener('keydown', function(event) {
            const memoryView = document.getElementById('view-memory');
            // åªæœ‰ç•¶è¨˜æ†¶æ¨¡å¼é¡¯ç¤ºä¸­ï¼Œæ‰å•Ÿç”¨ Space
            if (memoryView.classList.contains('active')) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    if (!isAnswerShown) {
                        toggleAnswer();
                    } else {
                        nextCard();
                    }
                }
            }
        });

        // å•Ÿå‹•
        init();

    </script>
</body>
</html>
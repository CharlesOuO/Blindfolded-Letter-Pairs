<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›²è§£è©åº«ç·´ç¿’ (UIå„ªåŒ–ç‰ˆ)</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* é ‚éƒ¨å°èˆª */
        .nav-bar {
            background: white;
            width: 100%;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 8px 20px;
            font-size: 1rem;
            border: 2px solid #2196f3;
            background: white;
            color: #2196f3;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }

        .nav-btn.active {
            background: #2196f3;
            color: white;
        }

        /* è³‡æ–™ç®¡ç†æŒ‰éˆ• */
        .data-btn {
            padding: 10px 20px;
            font-size: 0.95rem;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid #ccc;
            margin: 5px;
        }

        .container {
            max-width: 600px;
            width: 95%;
            margin-top: 20px;
            padding-bottom: 50px;
        }

        /* --- åˆ—è¡¨/èƒŒèª¦æ¨¡å¼æ¨£å¼ --- */
        .list-controls {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        select {
            padding: 10px;
            font-size: 1.2rem;
            width: 100%;
            max-width: 300px;
            border-radius: 8px;
            border: 1px solid #ccc;
        }

        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 15px;
        }

        .pair-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
        }

        .pair-label {
            font-size: 1.2rem;
            font-weight: bold;
            color: #555;
            margin-bottom: 5px;
            text-align: center;
        }

        .pair-input {
            padding: 5px;
            font-size: 1.1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            width: 90%;
            align-self: center;
        }

        .pair-input:focus {
            border-color: #2196f3;
            outline: none;
            background: #e3f2fd;
        }

        /* --- è¨˜æ†¶æ¨¡å¼æ¨£å¼ --- */
        .card-area {
            background: white;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 40px;
            margin: 20px 0;
            text-align: center;
            cursor: pointer;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .question { font-size: 5rem; font-weight: bold; color: #1565c0; }
        .answer { font-size: 2.5rem; color: #d32f2f; margin-top: 20px; font-weight: bold; display: none; }
        .answer.show { display: block; }
        .hint { color: #999; margin-top: 15px; font-size: 0.9rem; }

        .memory-controls { text-align: center; }
        .btn-primary {
            padding: 12px 30px;
            font-size: 1.2rem;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(33, 150, 243, 0.3);
        }

        /* è¨Šæ¯æ¡† */
        .alert-box {
            padding: 10px;
            border-radius: 5px;
            margin-top: 15px;
            display: none;
        }

        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .view-section { display: none; }
        .view-section.active { display: block; }

    </style>
</head>
<body>

    <div class="nav-bar">
        <button class="nav-btn active" onclick="switchTab('list')">ğŸ“ åˆ—è¡¨è¼¸å…¥</button>
        <button class="nav-btn" onclick="switchTab('memory')">ğŸ§  éš¨æ©Ÿæ¸¬é©—</button>
        <button class="nav-btn" onclick="switchTab('data')" style="border-color:#666; color:#666;">ğŸ’¾ å‚™ä»½ç®¡ç†</button>
    </div>

    <div class="container">

        <div id="view-list" class="view-section active">
            <div class="list-controls">
                <label style="display:block; margin-bottom:5px; color:#666;">é¸æ“‡é–‹é ­æ³¨éŸ³ï¼š</label>
                <select id="char-select" onchange="renderList()">
                    </select>
                <p style="font-size:0.9rem; color:#888; margin-top:10px;">
                    ğŸ’¡ æç¤ºï¼šè¼¸å…¥å®Œç›´æ¥æŒ‰ <strong>Enter</strong> æœƒè‡ªå‹•è·³åˆ°ä¸‹ä¸€æ ¼ï¼Œä¸¦è‡ªå‹•å„²å­˜ã€‚
                </p>
            </div>

            <div id="grid-area" class="grid-container">
                </div>
        </div>

        <div id="view-memory" class="view-section">
            <div class="list-controls">
                <label style="color:#666;">æ¸¬é©—ç¯„åœï¼š</label>
                <select id="memory-range" onchange="nextCard()">
                    <option value="all">å…¨ç¯„åœéš¨æ©Ÿ (All)</option>
                    </select>
            </div>

            <div class="card-area" onclick="toggleAnswer()">
                <div class="question" id="q-text">?</div>
                <div class="answer" id="a-text">...</div>
                <div class="hint" id="hint-text">(é»æ“Šç¿»ç‰Œçœ‹ç­”æ¡ˆ)</div>
            </div>

            <div class="memory-controls">
                <button class="btn-primary" onclick="nextCard()">ä¸‹ä¸€é¡Œ (Space)</button>
            </div>
        </div>

        <div id="view-data" class="view-section">
            <div class="list-controls" style="text-align: center;">
                <h3 style="margin-top:0;">ğŸ“‚ è³‡æ–™è½‰ç§»èˆ‡å‚™ä»½</h3>
                <p style="color:#555; text-align:left; line-height:1.6;">
                    å› ç‚ºé€™æ˜¯ä¸€å€‹ç„¡ä¼ºæœå™¨çš„ç¶²é ï¼Œè³‡æ–™åªæœƒå­˜åœ¨ä½ ç›®å‰çš„ç€è¦½å™¨è£¡ã€‚<br>
                    å¦‚æœä½ æƒ³æŠŠé›»è…¦æ‰“å¥½çš„è³‡æ–™å‚³åˆ°æ‰‹æ©Ÿï¼Œè«‹ä¾ç…§ä»¥ä¸‹æ­¥é©Ÿï¼š
                </p>
                <ol style="text-align:left; color:#555; margin-bottom:30px;">
                    <li>åœ¨é›»è…¦æŒ‰ã€Œä¸‹è¼‰å‚™ä»½ã€ã€‚</li>
                    <li>æŠŠä¸‹è¼‰çš„ .json æª”æ¡ˆå‚³åˆ°æ‰‹æ©Ÿ (Line/Email)ã€‚</li>
                    <li>ç”¨æ‰‹æ©Ÿæ‰“é–‹é€™å€‹ç¶²é ã€‚</li>
                    <li>åˆ°é€™è£¡æŒ‰ã€Œé‚„åŸå‚™ä»½ã€ä¸¦é¸æ“‡æª”æ¡ˆã€‚</li>
                </ol>
                
                <div style="margin: 20px 0;">
                    <button class="data-btn" style="background:#e3f2fd; border-color:#2196f3; color:#0d47a1;" onclick="exportData()">
                        ğŸ“¥ ä¸‹è¼‰å‚™ä»½æª” (.json)
                    </button>
                </div>

                <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">

                <div style="margin: 20px 0;">
                    <p>é¸æ“‡æª”æ¡ˆä»¥é‚„åŸï¼š</p>
                    <input type="file" id="file-input" accept=".json" style="margin-bottom:10px;">
                    <br>
                    <button class="data-btn" style="background:#e8f5e9; border-color:#4caf50; color:#1b5e20;" onclick="importData()">
                        ğŸ“¤ è®€å–ä¸¦é‚„åŸ
                    </button>
                </div>
                <div id="import-msg" class="alert-box"></div>
                
                <hr style="margin:20px 0; border:0; border-top:1px solid #eee;">
                
                <div style="text-align:right;">
                     <button class="data-btn" style="background:white; border-color:#d32f2f; color:#d32f2f;" onclick="clearAllData()">âš ï¸ æ¸…ç©ºæ‰€æœ‰è³‡æ–™</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. å®šç¾©æ³¨éŸ³åˆ—è¡¨ (24å­—) ---
        const chars = [
            'ã„…','ã„†','ã„‡','ã„ˆ','ã„‰','ã„Š','ã„‹','ã„Œ',
            'ã„','ã„','ã„','ã„','ã„‘','ã„’',
            'ã„“','ã„”','ã„•','ã„–','ã„—','ã„˜','ã„™',
            'ã„§','ã„¨','ã„©'
        ];

        // --- 2. è³‡æ–™å­˜å– (ä½¿ç”¨ LocalStorage) ---
        const STORAGE_KEY = 'bld_custom_dict_v3';
        
        function getDict() {
            return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};
        }

        function saveDict(newDict) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(newDict));
        }

        function saveWord(pair, word) {
            const dict = getDict();
            dict[pair] = word.trim();
            saveDict(dict);
        }

        // --- 3. ä»‹é¢åˆå§‹åŒ– ---
        function init() {
            const listSelect = document.getElementById('char-select');
            const memSelect = document.getElementById('memory-range');

            chars.forEach(c => {
                // List Mode
                let opt1 = document.createElement('option');
                opt1.value = c;
                opt1.innerText = `${c} é–‹é ­`;
                listSelect.appendChild(opt1);

                // Memory Mode
                let opt2 = document.createElement('option');
                opt2.value = c;
                opt2.innerText = `åªç·´ ${c} é–‹é ­`;
                memSelect.appendChild(opt2);
            });

            // â˜…â˜…â˜… æ–°å¢ï¼šç•¶ä½¿ç”¨è€…é»æ“Šé¸æ“‡æª”æ¡ˆæ™‚ï¼Œæ¸…é™¤èˆŠçš„æˆåŠŸè¨Šæ¯
            document.getElementById('file-input').addEventListener('click', function() {
                document.getElementById('import-msg').style.display = 'none';
            });

            renderList();
        }

        // --- 4. åˆ—è¡¨æ¨¡å¼é‚è¼¯ ---
        function renderList() {
            const startChar = document.getElementById('char-select').value;
            const container = document.getElementById('grid-area');
            const dict = getDict();

            container.innerHTML = ''; 

            chars.forEach((endChar) => {
                if (startChar === endChar) return; 

                const pair = startChar + endChar;
                const savedWord = dict[pair] || "";

                const div = document.createElement('div');
                div.className = 'pair-item';
                
                const label = document.createElement('div');
                label.className = 'pair-label';
                label.innerText = pair;

                const input = document.createElement('input');
                input.className = 'pair-input';
                input.type = 'text';
                input.value = savedWord;
                input.placeholder = "...";
                input.dataset.pair = pair;
                
                // è¼¸å…¥æ™‚å„²å­˜
                input.addEventListener('input', function() {
                    saveWord(this.dataset.pair, this.value);
                });

                // Enter è·³ä¸‹ä¸€æ ¼
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        const allInputs = document.querySelectorAll('.pair-input');
                        for(let i=0; i<allInputs.length; i++) {
                            if(allInputs[i] === this) {
                                if(i + 1 < allInputs.length) {
                                    allInputs[i+1].focus();
                                }
                                break;
                            }
                        }
                    }
                });

                div.appendChild(label);
                div.appendChild(input);
                container.appendChild(div);
            });
        }

        // --- 5. è¨˜æ†¶æ¨¡å¼é‚è¼¯ ---
        let currentPair = "";
        let isAnswerShown = false;

        function nextCard() {
            const range = document.getElementById('memory-range').value;
            let c1, c2;

            if (range === 'all') {
                c1 = chars[Math.floor(Math.random() * chars.length)];
            } else {
                c1 = range;
            }

            c2 = chars[Math.floor(Math.random() * chars.length)];
            while (c1 === c2) {
                c2 = chars[Math.floor(Math.random() * chars.length)];
            }

            currentPair = c1 + c2;

            document.getElementById('q-text').innerText = currentPair;
            document.getElementById('a-text').classList.remove('show');
            document.getElementById('hint-text').innerText = "(é»æ“Šç¿»ç‰Œ)";
            isAnswerShown = false;
        }

        function toggleAnswer() {
            if (isAnswerShown) return;

            const dict = getDict();
            const word = dict[currentPair];
            const answerEl = document.getElementById('a-text');
            
            if (word) {
                answerEl.innerText = word;
                answerEl.style.color = "#d32f2f";
            } else {
                answerEl.innerText = "(å°šæœªå®šç¾©)";
                answerEl.style.color = "#999";
            }

            answerEl.classList.add('show');
            document.getElementById('hint-text').innerText = "(æŒ‰ Space ä¸‹ä¸€é¡Œ)";
            isAnswerShown = true;
        }

        // --- 6. å‚™ä»½åŠŸèƒ½ ---
        function exportData() {
            const data = localStorage.getItem(STORAGE_KEY);
            if (!data || data === '{}') {
                alert("æ²’æœ‰è³‡æ–™å¯ä»¥å‚™ä»½å–”ï¼è«‹å…ˆå»è¼¸å…¥ä¸€äº›è©ã€‚");
                return;
            }
            const blob = new Blob([data], {type: "application/json"});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bld_dict_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importData() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            const msgBox = document.getElementById('import-msg');

            if (!file) {
                alert("è«‹å…ˆé¸æ“‡ä¸€å€‹ .json æª”æ¡ˆï¼");
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if (typeof json === 'object') {
                        localStorage.setItem(STORAGE_KEY, JSON.stringify(json));
                        msgBox.style.display = 'block';
                        msgBox.style.color = '#155724';
                        msgBox.style.backgroundColor = '#d4edda';
                        msgBox.innerText = "âœ… åŒ¯å…¥æˆåŠŸï¼ç¾åœ¨ä½ å¯ä»¥åˆ‡æ›åˆ†é å»ç·´ç¿’äº†ã€‚";
                        renderList(); // æ›´æ–°åˆ—è¡¨é¡¯ç¤º
                    } else {
                        throw new Error("æ ¼å¼éŒ¯èª¤");
                    }
                } catch (err) {
                    msgBox.style.display = 'block';
                    msgBox.style.color = '#721c24';
                    msgBox.style.backgroundColor = '#f8d7da';
                    msgBox.innerText = "âŒ æª”æ¡ˆæ ¼å¼ä¸å°ï¼Œè«‹ç¢ºèªé€™æ˜¯ä¹‹å‰å‚™ä»½çš„ .json æª”ã€‚";
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if(confirm("è­¦å‘Šï¼šé€™æœƒåˆªé™¤é€™å€‹è£ç½®ä¸Šçš„æ‰€æœ‰è³‡æ–™ï¼ç¢ºå®šè¦æ¸…ç©ºå—ï¼Ÿ")) {
                localStorage.removeItem(STORAGE_KEY);
                renderList();
                alert("å·²æ¸…ç©ºã€‚");
            }
        }

        // --- 7. é€šç”¨æ§åˆ¶ ---
        function switchTab(mode) {
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            // ç°¡å–®å°æ‡‰æŒ‰éˆ•èˆ‡æ¨¡å¼
            if(mode === 'list') document.querySelectorAll('.nav-btn')[0].classList.add('active');
            if(mode === 'memory') document.querySelectorAll('.nav-btn')[1].classList.add('active');
            if(mode === 'data') document.querySelectorAll('.nav-btn')[2].classList.add('active');

            document.querySelectorAll('.view-section').forEach(view => view.classList.remove('active'));
            document.getElementById('view-' + mode).classList.add('active');
            
            if (mode === 'list') renderList();
            if (mode === 'memory') nextCard();
        }

        // éµç›¤ Space æ§åˆ¶
        document.addEventListener('keydown', function(event) {
            const memoryView = document.getElementById('view-memory');
            if (memoryView.classList.contains('active')) {
                if (event.code === 'Space') {
                    event.preventDefault();
                    if (!isAnswerShown) toggleAnswer();
                    else nextCard();
                }
            }
        });

        init();

    </script>
</body>
</html>